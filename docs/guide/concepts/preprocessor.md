# ğŸ”§ å‰ç½®å¤„ç†å™¨

å‰ç½®å¤„ç†å™¨æ˜¯ Ryze æ¡†æ¶ä¸­åœ¨æµ‹è¯•ç»„ä»¶æ‰§è¡Œå‰è¿è¡Œçš„ç‰¹æ®Šç»„ä»¶ï¼Œç”¨äºæ‰§è¡Œé¢„å¤„ç†é€»è¾‘ï¼Œå¦‚æ•°æ®å‡†å¤‡ã€ç¯å¢ƒåˆå§‹åŒ–ã€è®¤è¯è·å–ç­‰ã€‚

## ğŸ” åŸºæœ¬æ¦‚å¿µ

### ä½œç”¨åŸç†

å‰ç½®å¤„ç†å™¨åœ¨æµ‹è¯•ç»„ä»¶ï¼ˆå–æ ·å™¨ã€æµ‹è¯•é›†åˆç­‰ï¼‰æ‰§è¡Œå‰è‡ªåŠ¨è¿è¡Œï¼Œå¯ä»¥æ‰§è¡Œå„ç§é¢„å¤„ç†é€»è¾‘ï¼Œä¸ºåç»­çš„æµ‹è¯•æ‰§è¡Œå‡†å¤‡å¿…è¦çš„æ¡ä»¶ã€‚

### é…ç½®ä½ç½®

å‰ç½®å¤„ç†å™¨å¯ä»¥é…ç½®åœ¨ï¼š

- **æµ‹è¯•é›†åˆä¸­**ï¼šåœ¨æµ‹è¯•é›†åˆæ‰§è¡Œå‰è¿è¡Œ
- **å–æ ·å™¨ä¸­**ï¼šåœ¨å–æ ·å™¨æ‰§è¡Œå‰è¿è¡Œ
- **æ¨¡å—çº§é›†åˆ**ï¼šåœ¨æ¨¡å—æµ‹è¯•å‰è¿è¡Œ
- **é¡¹ç›®çº§é›†åˆ**ï¼šåœ¨æ•´ä¸ªé¡¹ç›®æµ‹è¯•å‰è¿è¡Œ

## ğŸ¯ è®¾è®¡ç†å¿µ

### æµ‹è¯•å‡†å¤‡è‡ªåŠ¨åŒ–

å‰ç½®å¤„ç†å™¨çš„è®¾è®¡ç†å¿µæ˜¯å®ç°æµ‹è¯•å‡†å¤‡çš„è‡ªåŠ¨åŒ–ï¼š

- **æ•°æ®å‡†å¤‡**ï¼šè‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ‰€éœ€çš„æ•°æ®
- **ç¯å¢ƒåˆå§‹åŒ–**ï¼šç¡®ä¿æµ‹è¯•ç¯å¢ƒå¤„äºé¢„æœŸçŠ¶æ€
- **è®¤è¯è·å–**ï¼šè‡ªåŠ¨è·å–æµ‹è¯•æ‰€éœ€çš„è®¤è¯ä¿¡æ¯
- **èµ„æºé¢„åˆ†é…**ï¼šé¢„å…ˆåˆ†é…æµ‹è¯•æ‰€éœ€çš„èµ„æº

### åè®®æ— å…³æ€§

å‰ç½®å¤„ç†å™¨è®¾è®¡ä¸ºåè®®æ— å…³çš„ç»„ä»¶ï¼Œä¸åŒåè®®çš„å‰ç½®å¤„ç†å™¨å…·æœ‰ç›¸ä¼¼çš„ç»“æ„å’Œä½¿ç”¨æ–¹å¼ï¼š

```yaml
# é€šç”¨å‰ç½®å¤„ç†å™¨ç»“æ„
- testclass: åè®®ç±»å‹
  config:
  # åè®®ç‰¹å®šé…ç½®é¡¹
```

## â±ï¸ æ‰§è¡Œæ—¶æœº

### æ‰§è¡Œé¡ºåº

å‰ç½®å¤„ç†å™¨éµå¾ªä¸¥æ ¼çš„æ‰§è¡Œé¡ºåºï¼š

1. **é¡¹ç›®çº§å‰ç½®å¤„ç†å™¨**ï¼šæœ€å…ˆæ‰§è¡Œ
2. **æ¨¡å—çº§å‰ç½®å¤„ç†å™¨**ï¼šå…¶æ¬¡æ‰§è¡Œ
3. **é›†åˆçº§å‰ç½®å¤„ç†å™¨**ï¼šç„¶åæ‰§è¡Œ
4. **å–æ ·å™¨çº§å‰ç½®å¤„ç†å™¨**ï¼šæœ€åæ‰§è¡Œ

### æ‰§è¡Œä¸Šä¸‹æ–‡

å‰ç½®å¤„ç†å™¨åœ¨æ‰§è¡Œæ—¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **å˜é‡ç»§æ‰¿**ï¼šå¯ä»¥è®¿é—®çˆ¶çº§å®šä¹‰çš„å˜é‡
- **é…ç½®ç»§æ‰¿**ï¼šå¯ä»¥ç»§æ‰¿é…ç½®å…ƒä»¶çš„é…ç½®
- **ç»“æœä¼ é€’**ï¼šå¯ä»¥å°†å¤„ç†ç»“æœé€šè¿‡å˜é‡ä¼ é€’ç»™åç»­ç»„ä»¶

```yaml
title: æµ‹è¯•é›†åˆ
variables:
  user_id: 12345

# é¡¹ç›®çº§å‰ç½®å¤„ç†å™¨
preprocessors:
  - testclass: http
    config:
      method: POST
      path: /auth/login
      body:
        username: admin
        password: password
    extractors:
      # æå–è®¤è¯tokenä¾›åç»­ä½¿ç”¨
      - { testclass: json, field: '$.data.token', ref_name: auth_token }

children:
  - title: ç”¨æˆ·æ“ä½œæµ‹è¯•
    # æ¨¡å—çº§å‰ç½®å¤„ç†å™¨
    preprocessors:
      - testclass: http
        config:
          method: POST
          path: /users
          headers:
            Authorization: Bearer ${auth_token}  # ä½¿ç”¨ä¸Šçº§æå–çš„token
          body:
            name: Test User
        extractors:
          # æå–æ–°åˆ›å»ºçš„ç”¨æˆ·ID
          - { testclass: json, field: '$.data.id', ref_name: new_user_id }

    children:
      - testclass: http
        # å–æ ·å™¨çº§å‰ç½®å¤„ç†å™¨
        preprocessors:
          - testclass: http
            config:
              method: PUT
              path: /users/${new_user_id}/profile
              headers:
                Authorization: Bearer ${auth_token}
              body:
                status: active
        # ä¸»è¦æµ‹è¯•é€»è¾‘
        config:
          method: GET
          path: /users/${new_user_id}
          headers:
            Authorization: Bearer ${auth_token}
```

## ğŸŒ å„åè®®å‰ç½®å¤„ç†å™¨

### ğŸŒ HTTP å‰ç½®å¤„ç†å™¨

ç”¨äºæ‰§è¡Œ HTTP è¯·æ±‚ä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: http
  config:
    method: post
    protocol: http
    http/2: false
    port: 8080
    host: localhost
    path: /user
    headers:
      h1: 1
    query: { }
    data: { }
    body: { userName: 'ryze', password: '123456qq' }
```

**ç›¸å…³æ–‡æ¡£**ï¼š[HTTP åè®®æ–‡æ¡£](/guide/protocols/http)

### ğŸ—„ï¸ JDBC å‰ç½®å¤„ç†å™¨

ç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: jdbc
  config:
    sql: "INSERT INTO users (name, email) VALUES ('testuser', 'test@example.com')"
```

**ç›¸å…³æ–‡æ¡£**ï¼š[JDBC åè®®æ–‡æ¡£](/guide/protocols/jdbc)

### ğŸ—ƒï¸ Redis å‰ç½®å¤„ç†å™¨

ç”¨äºæ‰§è¡Œ Redis æ“ä½œä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: redis
  config:
    command: SET
    key: test_key
    value: test_value
```

**ç›¸å…³æ–‡æ¡£**ï¼š[Redis åè®®æ–‡æ¡£](/guide/protocols/redis)

### ğŸ”Œ Dubbo å‰ç½®å¤„ç†å™¨

ç”¨äºæ‰§è¡Œ Dubbo æœåŠ¡è°ƒç”¨ä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: dubbo
  config:
    interface: com.example.UserService
    method: createUser
    parameters:
      - "testuser"
      - "test@example.com"
```

**ç›¸å…³æ–‡æ¡£**ï¼š[Dubbo åè®®æ–‡æ¡£](/guide/protocols/dubbo)

### ğŸš€ Kafka å‰ç½®å¤„ç†å™¨

ç”¨äºå‘é€ Kafka æ¶ˆæ¯ä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: kafka
  config:
    topic: user-events
    key: user-created
    value: '{"userId": 12345, "action": "create"}'
```

**ç›¸å…³æ–‡æ¡£**ï¼š[Kafka åè®®æ–‡æ¡£](/guide/protocols/kafka)

### ğŸ° RabbitMQ å‰ç½®å¤„ç†å™¨

ç”¨äºå‘é€ RabbitMQ æ¶ˆæ¯ä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: rabbit
  config:
    exchange: user-exchange
    routing_key: user.created
    message: '{"userId": 12345, "timestamp": "${timestamp()}"}'
```

**ç›¸å…³æ–‡æ¡£**ï¼š[RabbitMQ åè®®æ–‡æ¡£](/guide/protocols/rabbitmq)

### ğŸ¯ ActiveMQ å‰ç½®å¤„ç†å™¨

ç”¨äºå‘é€ ActiveMQ æ¶ˆæ¯ä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: active
  config:
    destination: user-queue
    message: '{"userId": 12345, "action": "create"}'
```

**ç›¸å…³æ–‡æ¡£**ï¼š[ActiveMQ åè®®æ–‡æ¡£](/guide/protocols/activemq)

### ğŸƒ MongoDB å‰ç½®å¤„ç†å™¨

ç”¨äºæ‰§è¡Œ MongoDB æ“ä½œä½œä¸ºå‰ç½®å¤„ç†é€»è¾‘ã€‚

**é…ç½®æ¨¡æ¿**

```yaml
- testclass: mongo
  config:
    operation: insert
    collection: users
    document: '{"name": "testuser", "email": "test@example.com"}'
```

**ç›¸å…³æ–‡æ¡£**ï¼š[MongoDB åè®®æ–‡æ¡£](/guide/protocols/mongodb)

## ğŸ”§ ä½¿ç”¨åœºæ™¯

### è®¤è¯ä»¤ç‰Œè·å–

åœ¨æµ‹è¯•å‰è·å–è®¤è¯ä»¤ç‰Œï¼š

```yaml
title: éœ€è¦è®¤è¯çš„APIæµ‹è¯•
preprocessors:
  # è·å–è®¤è¯ä»¤ç‰Œ
  - testclass: http
    config:
      method: POST
      path: /auth/login
      body:
        username: testuser
        password: password123
    extractors:
      - { testclass: json, field: '$.data.token', ref_name: auth_token }

children:
  - testclass: http
    config:
      method: GET
      path: /user/profile
      headers:
        Authorization: Bearer ${auth_token}  # ä½¿ç”¨è·å–çš„ä»¤ç‰Œ
```

### æµ‹è¯•æ•°æ®å‡†å¤‡

åœ¨æµ‹è¯•å‰å‡†å¤‡å¿…è¦çš„æµ‹è¯•æ•°æ®ï¼š

```yaml
title: ç”¨æˆ·è®¢å•æµ‹è¯•
preprocessors:
  # åˆ›å»ºæµ‹è¯•ç”¨æˆ·
  - testclass: http
    config:
      method: POST
      path: /users
      body:
        name: Test User
        email: test@example.com
    extractors:
      - { testclass: json, field: '$.data.id', ref_name: user_id }

  # ä¸ºç”¨æˆ·åˆ›å»ºåˆå§‹è®¢å•
  - testclass: http
    config:
      method: POST
      path: /users/${user_id}/orders
      body:
        product_id: 12345
        quantity: 2
    extractors:
      - { testclass: json, field: '$.data.order_id', ref_name: order_id }

children:
  - testclass: http
    config:
      method: GET
      path: /orders/${order_id}
      # æµ‹è¯•è®¢å•è¯¦æƒ…
```

### ç¯å¢ƒçŠ¶æ€åˆå§‹åŒ–

åœ¨æµ‹è¯•å‰åˆå§‹åŒ–ç¯å¢ƒçŠ¶æ€ï¼š

```yaml
title: åº“å­˜ç®¡ç†ç³»ç»Ÿæµ‹è¯•
preprocessors:
  # æ¸…ç†æµ‹è¯•æ•°æ®
  - testclass: jdbc
    config:
      sql: "DELETE FROM inventory WHERE product_id LIKE 'TEST_%'"

  # åˆå§‹åŒ–æµ‹è¯•åº“å­˜
  - testclass: jdbc
    config:
      sql: |
        INSERT INTO inventory (product_id, quantity, reserved) VALUES
        ('TEST_001', 100, 0),
        ('TEST_002', 50, 0),
        ('TEST_003', 200, 0)

children:
  - title: åº“å­˜æ‰£å‡æµ‹è¯•
    # æ‰§è¡Œåº“å­˜æ‰£å‡æ“ä½œæµ‹è¯•
```

### ä¾èµ–æœåŠ¡å‡†å¤‡

åœ¨æµ‹è¯•å‰å‡†å¤‡ä¾èµ–æœåŠ¡ï¼š

```yaml
title: è®¢å•æ”¯ä»˜æµ‹è¯•
preprocessors:
  # ç¡®ä¿æ”¯ä»˜æœåŠ¡å¯ç”¨
  - testclass: http
    config:
      method: GET
      path: /health
      host: payment-service

  # é¢„å…ˆåˆ›å»ºæ”¯ä»˜è´¦æˆ·
  - testclass: http
    config:
      method: POST
      path: /accounts
      body:
        user_id: ${user_id}
        balance: 1000.00
    extractors:
      - { testclass: json, field: '$.data.account_id', ref_name: account_id }

children:
  - testclass: http
    config:
      method: POST
      path: /payments
      body:
        account_id: ${account_id}
        amount: 99.99
```

## ğŸ“š æœ€ä½³å®è·µ

### å¤„ç†å™¨åˆ†å±‚åŸåˆ™

#### é¡¹ç›®çº§å¤„ç†å™¨

- **å…¨å±€åˆå§‹åŒ–**ï¼šæ•´ä¸ªé¡¹ç›®çš„é€šç”¨åˆå§‹åŒ–é€»è¾‘
- **è®¤è¯è·å–**ï¼šè·å–é¡¹ç›®çº§çš„è®¤è¯ä¿¡æ¯
- **ç¯å¢ƒæ£€æŸ¥**ï¼šæ£€æŸ¥æµ‹è¯•ç¯å¢ƒæ˜¯å¦å°±ç»ª

#### æ¨¡å—çº§å¤„ç†å™¨

- **æ¨¡å—å‡†å¤‡**ï¼šç‰¹å®šæ¨¡å—çš„å‡†å¤‡å·¥ä½œ
- **æ•°æ®åˆå§‹åŒ–**ï¼šæ¨¡å—ç‰¹å®šçš„æµ‹è¯•æ•°æ®å‡†å¤‡
- **æœåŠ¡æ£€æŸ¥**ï¼šæ£€æŸ¥æ¨¡å—ä¾èµ–çš„æœåŠ¡çŠ¶æ€

#### ç”¨ä¾‹çº§å¤„ç†å™¨

- **ç”¨ä¾‹å‡†å¤‡**ï¼šå½“å‰ç”¨ä¾‹ç‰¹å®šçš„å‡†å¤‡å·¥ä½œ
- **çŠ¶æ€è®¾ç½®**ï¼šè®¾ç½®æµ‹è¯•æ‰€éœ€çš„ç‰¹å®šçŠ¶æ€
- **èµ„æºåˆ†é…**ï¼šåˆ†é…ç”¨ä¾‹æ‰€éœ€çš„èµ„æº

### é”™è¯¯å¤„ç†

#### å¼‚å¸¸æ•è·

```yaml
preprocessors:
  - testclass: http
    config:
      method: POST
      path: /auth/login
      body:
        username: testuser
        password: password123
    # å¤„ç†ç™»å½•å¤±è´¥çš„æƒ…å†µ
    assertions:
      - { testclass: http, field: 'status', expected: 200, rule: '==' }
```

#### é‡è¯•æœºåˆ¶

```yaml
preprocessors:
  - testclass: http
    config:
      method: GET
      path: /health
    # å¦‚æœæœåŠ¡æœªå°±ç»ªï¼Œå¯ä»¥è®¾ç½®é‡è¯•
    interceptors:
      - RetryInterceptor:
          max_attempts: 3
          retry_delay: 1000
```

### æ€§èƒ½ä¼˜åŒ–

#### å¹¶è¡Œå¤„ç†

å¯¹äºç›¸äº’ç‹¬ç«‹çš„å‰ç½®å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘å¹¶è¡Œæ‰§è¡Œï¼š

```yaml
preprocessors:
  # è¿™äº›å¤„ç†å™¨å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
  - testclass: http
    config:
      method: GET
      path: /service1/health

  - testclass: http
    config:
      method: GET
      path: /service2/health
```

#### ç¼“å­˜åˆ©ç”¨

å¯¹äºé‡å¤çš„å‰ç½®å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜ç»“æœï¼š

```yaml
variables:
  # ç¼“å­˜è®¤è¯ä»¤ç‰Œï¼ˆå¦‚æœåœ¨æœ‰æ•ˆæœŸå†…ï¼‰
  cached_token: ${get_cached_token()}

preprocessors:
  - testclass: http
    # ä»…åœ¨æ²¡æœ‰ç¼“å­˜ä»¤ç‰Œæ—¶æ‰§è¡Œ
    condition: ${cached_token == null}
    config:
      method: POST
      path: /auth/login
      body:
        username: testuser
        password: password123
    extractors:
      - { testclass: json, field: '$.data.token', ref_name: auth_token }
```

### å¯ç»´æŠ¤æ€§

#### é…ç½®åˆ†ç¦»

å°†å¤æ‚çš„å‰ç½®å¤„ç†é…ç½®åˆ†ç¦»åˆ°ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼š

```yaml
# åœ¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å¤æ‚çš„å¤„ç†å™¨
preprocessors:
  - !include 'processors/setup_test_environment.yaml'
  - !include 'processors/create_test_data.yaml'
```

#### æ¨¡å—åŒ–è®¾è®¡

å°†ç›¸å…³çš„å‰ç½®å¤„ç†é€»è¾‘ç»„ç»‡æˆæ¨¡å—ï¼š

```yaml
preprocessors:
  # ç”¨æˆ·æ¨¡å—åˆå§‹åŒ–
  - !include 'processors/user_module_init.yaml'
  # è®¢å•æ¨¡å—åˆå§‹åŒ–
  - !include 'processors/order_module_init.yaml'
```

**ğŸ’¡ æç¤º**ï¼šå‰ç½®å¤„ç†å™¨æ˜¯å®ç°æµ‹è¯•è‡ªåŠ¨åŒ–çš„é‡è¦å·¥å…·ï¼Œåˆç†ä½¿ç”¨å¯ä»¥æ˜¾è‘—æé«˜æµ‹è¯•æ•ˆç‡å’Œå¯é æ€§ï¼